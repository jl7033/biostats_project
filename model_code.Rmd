---
title: "biostats_project"
author: "Joe LaRocca"
date: "2024-12-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(glmnet)
```

## Upload Data

```{r}

proj_1_data = read_csv("data/Project_1_Data.csv") |>
  janitor::clean_names() |>
  mutate(wkly_study_hours = 
           case_match(
             wkly_study_hours,
             "< 5" ~ "< 5 hours",
             "10-May" ~ "5-10 hours",
             "> 10" ~ "> 10 hours"
           ),
         ethnic_group = 
           case_match(
             ethnic_group,
             "group A" ~ "A",
             "group B" ~ "B",
             "group C" ~ "C",
             "group D" ~ "D",
             "group E" ~ "E"
           ),
         nr_siblings = 
           case_match(
             nr_siblings,
             0 ~ "0",
             1 ~ "1",
             2 ~ "2",
             3 ~ "3",
             4 ~ "4+",
             5 ~ "4+",
             6 ~ "4+",
             7 ~ "4+"
           )
         ) |>
  drop_na()

```

## Create Table Summarizing Response Variables

```{r}

proj_1_data |>
  select(math_score, reading_score, writing_score) |>
  pivot_longer(
    cols= everything(),
    names_to = "Test",
    values_to = "Score"
  ) |>
  group_by(Test) |>
  summarize(Mean = round(mean(Score), 2),
            StDev = round(sd(Score), 2),
            Min = min(Score),
            Max = max(Score)) |>
  mutate(Test = case_match(
    Test,
    "math_score" ~ "Math",
    "reading_score" ~ "Reading",
    "writing_score" ~ "Writing"
    )
  ) |>
  knitr::kable()

```

## Single-Variable Categorical Plots

### Ethnic Group

```{r}

proj_1_data |>
  ggplot(aes(x = ethnic_group)) + 
  geom_bar()

```

### Parent Education

```{r}

proj_1_data |>
  ggplot(aes(x = parent_educ)) + 
  geom_bar()

```

### Lunch Type

```{r}

proj_1_data |>
  ggplot(aes(x = lunch_type)) + 
  geom_bar()

```

### Test Prep

```{r}

proj_1_data |>
  ggplot(aes(x = test_prep)) + 
  geom_bar()

```

### Parent Marital Status

```{r}

proj_1_data |>
  ggplot(aes(x = parent_marital_status)) + 
  geom_bar()

```

### Practicing Sports

```{r}

proj_1_data |>
  ggplot(aes(x = practice_sport)) + 
  geom_bar()

```

### First Child

```{r}

proj_1_data |>
  ggplot(aes(x = is_first_child)) + 
  geom_bar()

```

### Number of Siblings

```{r}

proj_1_data |>
  ggplot(aes(x = nr_siblings)) + 
  geom_bar()

```

# Modeling

### Create Data Frames with only Math, Reading, Writing to Make LM Functions Easier to Write

```{r}

math_data = proj_1_data |>
  select(-reading_score, -writing_score)

reading_data = proj_1_data |>
  select(-math_score, -writing_score)

writing_data = proj_1_data |>
  select(-math_score, -reading_score)

```

## All Predictors

### Math_All

```{r}

lm_all_math = lm(math_score ~ ., data = math_data)

summary(lm_all_math)

lm_all_math |> broom::glance() |> select(adj.r.squared)

```

### Reading_All

```{r}

lm_all_reading = lm(reading_score ~ ., data = reading_data)

summary(lm_all_reading)

lm_all_reading |> broom::glance() |> select(adj.r.squared)

```

### Writing_All

```{r}

lm_all_writing = lm(writing_score ~ ., data = writing_data)

summary(lm_all_writing)

lm_all_writing |> broom::glance() |> select(adj.r.squared)

```

## LASSO

### Math_LASSO

```{r}

math_pred = model.matrix(math_score ~ ., math_data)[, -1]

math_score = pull(math_data, math_score)

math_cv = cv.glmnet(x = math_pred, y = math_score)

math_lasso = glmnet(math_pred, math_score, lambda = math_cv$lambda.min) 

r2_math_lasso = math_lasso$dev.ratio

adj_r2_math_lasso = 1 - ((1 - r2_math_lasso) * (nrow(math_data) - 1)) / (nrow(math_data) - nrow(broom::tidy(math_lasso)) - 1)

adj_r2_math_lasso

```

### Reading_LASSO

```{r}

reading_pred = model.matrix(reading_score ~ ., reading_data)[, -1]

reading_score = pull(reading_data, reading_score)

reading_cv = cv.glmnet(x = reading_pred, y = reading_score)

reading_lasso = glmnet(reading_pred, reading_score, lambda = reading_cv$lambda.min) 

r2_reading_lasso = reading_lasso$dev.ratio

adj_r2_reading_lasso = 1 - ((1 - r2_reading_lasso) * (nrow(reading_data) - 1)) / (nrow(reading_data) - nrow(broom::tidy(reading_lasso)) - 1)

adj_r2_reading_lasso

```

### Writing_LASSO

```{r}

writing_pred = model.matrix(writing_score ~ ., writing_data)[, -1]

writing_score = pull(writing_data, writing_score)

writing_cv = cv.glmnet(x = writing_pred, y = writing_score)

writing_lasso = glmnet(writing_pred, writing_score, lambda = writing_cv$lambda.min) 

r2_writing_lasso = writing_lasso$dev.ratio

adj_r2_writing_lasso = 1 - ((1 - r2_writing_lasso) * (nrow(writing_data) - 1)) / (nrow(writing_data) - nrow(broom::tidy(writing_lasso)) - 1)

adj_r2_writing_lasso

```

